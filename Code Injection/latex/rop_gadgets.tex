The basic operation of ROP is performed by redirecting the locations jumped to via buffer overflow. This method does not actually insert any executable code onto the stack --- existing code is merely utilized in creative ways. Gadgets are the building blocks of ROP. Any gadget used in ROP must contain a return-like command. 

Because Thumb assembly does not contain any return commands, alternatives to this command must be used. Two such instructions are bx and pop \{pc\}. The bx / pop and the preceding lines of code are what constitute a gadget. Many gadgets exist, but careful selection can produce a turing-complete instruction set. 

The flash rewrite sequence contained in Figures \ref{fig::erase} and \ref{fig::alt_prog} requires two operations: load and store. Our search for gadgets resulted in two effective sets of instructions, located in Figure \ref{fig::gadget1}. 

	\begin{figure}[htbp]
		\lstset{language={[thumb]Assembler}} 
		\begin{lstlisting}
; Gadget A
str R0, [R4,#0x0]
pop {R4,PC}

; Gadget B
mov R0, R4
pop {R4-R6,PC}
		\end{lstlisting}
		\caption{Gadgets that provide the required load and store operations. }\label{fig::gadget1}
	\end{figure}
% Table generated by Excel2LaTeX from sheet 'Sheet1'
Gadget A: this gadget provides the ability to store data from R0 into the address specified at R4. It also causes the program to jump to the next instruction, while filling R4 with more data from the stack. This gadget is effective because R4 is constantly updated. 

Gadget B: this gadget transfers the data from R4 into R0. There were no gadgets that would load R0 directly, so this method was a sufficient substitute. The data from the stack is transferred from the stack to R4 during Gadget A, followed by Gadget B where the data is shuttled to R0 while R4 is repopulated. Finally, the data is stored into the desired location via Gadget A. 


